/*
 *  Fisotope - v1.0.0-beta
 *  A wrapper to the exquisite jQuery plugin for magical layouts Isotope. Make it easy to filter, sort, and query words by using html attributes and classes.
 *  https://github.com/mativs/fisotope
 *
 *  Made by Matias Saguir
 *  Under ISC License
 */
!function(a,b,c){"use strict";function d(c,d,g){this.element=c,this.$element=a(c),this.settings=a.extend({},f,d),this.hashDict={},this._defaults=f,this.callback=g?g:function(){},this._name=e,this.mapping={},this.categories={},this.facets=[],this.selectedFacets={},this.selectedOperators=[],this.filterSelector="",this.utils={normalize:function(a){var b=[],c=0,d=a.length,e=0;for(c=0;d>c;c++)e=a.charAt(c),b.push(this.mapping.hasOwnProperty(a.charAt(c))?this.mapping[e]:e);return b.join("")},unique:function(b){return a.grep(b,function(c,d){return d===a.inArray(c,b)})},getMapFacetSelector:function(a){return function(b){return"[fiso-"+a+"*='."+b+".']"}},combineSelectors:function(a,b){var c,d,e,f,g,h="";if(b&&(h="[search-text*='"+b.toLowerCase()+"']"),0===a.length)return[h];c=a.pop(),d=this.combineSelectors(a,b),e=[];for(f in c)for(g in d)e.push(c[f]+d[g]);return e},getOperator:function(a,b,c){return b?b:c.default_facet_operator&&c.default_facet_operator[a]?this.settings.default_facet_operator[a]:c.default_operator},getNextOperator:function(a,b){var c=b.indexOf(a),d=c+1;return d=d===b.length?0:d,b[d]},getCategoriesFromAttribute:function(b){return b?a.grep(b.split("."),function(a){return a.length>0}):[]},switchFacetCategory:function(a,b,c){var d,e="."+a+".";switch(c=c?c:".",d=c.indexOf("."+a+".")>=0,b){case"and":case"or":e=d?c.replace("."+a+".","."):c+a+".";break;case"unique":e=d?"":"."+a+"."}return"."!==e?e:""},getJqueryFilter:function(b,c,d,e){var f,g,h,i,j,k=[];for(f in b)if(g=this.getOperator(f,c[f],e),h=b[f],h.length>0)switch(i=a.map(h,this.getMapFacetSelector(f)),g){case"or":k.push(i);break;case"and":k.push([i.join("")]);break;case"unique":k.push([i[i.length-1]])}return j=this.combineSelectors(k,d),"hide"===e.empty_selection_behaviour&&0===j.length?".asdlkfasdlkasdfkl32923u42kj349":j.join()},isEligible:function(b,c,d){var e,f,g=jQuery.extend(!0,{},d.selectedFacets);return g[b]?(e=g[b].indexOf(c),0>e?g[b].push(c):g[b].splice(e,1)):g[b]=[c],f=this.getJqueryFilter(g,d.selectedOperators,d.hashDict.query,d.settings),f?a(f).length>0:!0},getSelectedCategories:function(a,b,c){if(c)switch(b){case"unique":return[c[c.length-1]];default:return c}return[]},getEligibleCategories:function(a,b,c){var d,e=[];for(d in b)this.isEligible(a,b[d],c)&&e.push(b[d]);return e},getAvailableCategories:function(b,c){var d,e,f=[],g=this;return c.filterSelector?(a(c.filterSelector).each(function(c,h){d=a(h),e=d.attr("fiso-"+b),f=f.concat(g.getCategoriesFromAttribute(e))}),f=this.unique(f),f=a.grep(f,function(b){return a.inArray(b,c.selectedCategories)<0})):f=c.categories[b],f.sort(),f.reverse(),f},updateSearch:function(b){var c=a("input.fiso-search");c.val(b)},updateTotals:function(b){var c=a(".fiso-total-counter"),d=a(".fiso-total-hidden"),e=a(".fiso-total-visible"),f=a(b.settings.itemSelector).length,g=b.filterSelector?a(b.filterSelector).length:f,h=f-g;c.text(f),d.text(h),e.text(g)},updateCategoryStatus:function(b,c,d,e){var f,g,h;null!=d&&(d.addClass("not-"+c),f=a.map(e,function(a){return'.fiso-toggle-category[fiso-category="'+a+'"]'}),g=a(f.join()),g.removeClass("not-"+c),g.addClass(c)),h=a(".fiso-counter-"+c+'[fiso-facet="'+b+'"]'),h.text(e.length)},updateSelectorStatus:function(a,b,c){var d;0===c.length&&b.addClass("fiso-no-"+a),d=b.find(".fiso-toggle-category."+a),b.length>0&&(d.first().addClass("first-"+a),d.last().addClass("last-"+a)),b.addClass("fiso-"+a+"-"+c.length)},updateFacet:function(b,c,d){var e,f,g,h,i,j,k=a('.fiso-toggle-category[fiso-facet="'+b+'"]'),l=a('.fiso-toggle-facet[fiso-facet="'+b+'"]'),m=this.getSelectedCategories(b,c,d.selectedFacets[b]),n=this.getAvailableCategories(b,d),o=this.getEligibleCategories(b,d.categories[b],d);e="or and unique selected eligible not-eligible available not-available first-selected last-selected not-selected first-available last-available",k.removeClass(e),l.removeClass("or and unique"),k.addClass(c),l.addClass(c),this.updateCategoryStatus(b,"selected",k,m),this.updateCategoryStatus(b,"available",k,n),this.updateCategoryStatus(b,"eligible",k,o),this.updateCategoryStatus(b,"all",null,d.categories),f=this,a('.fiso-selector[fiso-facet="'+b+'"]').each(function(){g=a(this),e="or and unique fiso-no-categories fiso-no-eligible fiso-no-selected fiso-no-available",g.removeClass(e),g.removeClass(function(){h=a(this).attr("class").split(" "),i=[];for(var b in h)j=h[b],(0===j.indexOf("fiso-selected")||0===j.indexOf("fiso-all")||0===j.indexOf("fiso-available")||0===j.indexOf("fiso-eligible"))&&i.push(j);return i.join(" ")}),g.addClass(c),f.updateSelectorStatus("selected",g,m),f.updateSelectorStatus("available",g,n),f.updateSelectorStatus("eligible",g,o),f.updateSelectorStatus("all",g,d.categories)})}},this.events={urlChanged:function(a){return a.data.filterItems(),a.data.updateInfo(),a.preventDefault()},toggleFacet:function(c){var d=a(this),e=d.attr("fiso-facet"),f=e+"_op",g=c.data.utils.getOperator(e,c.data.hashDict[f],c.data.settings);return c.data.hashDict[f]=c.data.utils.getNextOperator(g,c.data.settings.operators_pool),b.location.hash=a.param(c.data.hashDict),c.preventDefault()},toggleQuery:function(c){var d=a(this).val();return c.data.hashDict.query=d,b.location.hash=a.param(c.data.hashDict),c.preventDefault()},toggleSort:function(c){var d=a(this),e=d.attr("sort-by"),f=d.attr("sort-order"),g=f?f:c.data.settings.sort_default;return c.data.hashDict.sort=e,c.data.hashDict.sort_order=g,b.location.hash=a.param(c.data.hashDict),c.preventDefault()},toggleFacetCategory:function(c){var d=a(this),e=d.attr("fiso-facet"),f=d.attr("fiso-category"),g=c.data.utils.getOperator(e,c.data.hashDict[e+"_op"],c.data.settings),h=e+"_cats",i=c.data.utils.switchFacetCategory(f,g,c.data.hashDict[h]);return c.data.hashDict[h]=i,b.location.hash=a.param(c.data.hashDict),c.preventDefault()},clearFacet:function(c){var d=a(this),e=d.attr("fiso-facet");switch(e){case"query":delete c.data.hashDict.query;break;case"sort":delete c.data.hashDict.sort,delete c.data.hashDict.sort_order;break;case"all":c.data.hashDict={};break;default:delete c.data.hashDict[e+"_cats"],delete c.data.hashDict[e+"_op"]}return b.location.hash=a.param(c.data.hashDict),c.preventDefault()}},this.init()}var e="fisotope",f={default_operator:"and",default_sort_name:"original-order",empty_selection_behaviour:"show",default_sort_order:"asc",itemSelector:".item",operators_pool:["and","or","unique"]};d.prototype={init:function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this.$element.find(this.settings.itemSelector)[0].attributes,t={getSortData:{}},u=function(b){return a(b).attr(e).split(".").length-2};for(c=0;c<s.length;c++)e=s[c].name,0===e.indexOf("fiso-")&&(f=e.substr(5),t.getSortData[f+"_count"]=u);for(a.extend(!0,this.settings,t),this.$element.isotope(this.settings,this.callback),this.reloadFacetAndCategories(),g=this,a(".fiso-selector").each(function(){if(h=a(this),i=h.attr("fiso-facet"),j=h.find(".fiso-example"),i&&j.length>0){if(k=j.parent(),l=g.categories[i])for(c=0;c<l.length;c++)m=l[c],n=j.clone(),n.removeClass("fiso-example"),o=n.find("a").andSelf().filter("a"),o.append(m),o.addClass("fiso-toggle-category"),o.attr("fiso-facet",i),o.attr("fiso-category",m),k.prepend(n);j.remove()}}),p="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",q="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",a(this.settings.itemSelector).each(function(){r=a(this).text().replace(/\s+/g," ").toLowerCase(),a(this).attr("search-text",r)}),a.expr[":"].contains=function(b,c,d){return this.utils.normalize(a(b).text().toUpperCase()).indexOf(this.utils.normalize(d[3].toUpperCase()))>=0},c=0,d=p.length;d>c;c++)this.mapping[p.charAt(c)]=q.charAt(c);a(b).bind("hashchange.fisotope",this,this.events.urlChanged).trigger("hashchange"),a("a.fiso-toggle-category").bind("click.fisotope",this,this.events.toggleFacetCategory),a("a.fiso-clear-facet").bind("click.fisotope",this,this.events.clearFacet),a("a.fiso-toggle-facet").bind("click.fisotope",this,this.events.toggleFacet),a("a.toggle-sort").bind("click.fisotope",this,this.events.toggleSort),a("input.fiso-search").bind("keyup.fisotope",this,this.events.toggleQuery)},parseHash:function(){var a,b,d,e,f=c.location.hash.substring(1).split("&");this.selectedFacets={},this.selectedOperators=[],this.hashDict={};for(a in f)b=f[a].split("="),2===b.length&&(this.hashDict[b[0]]=b[1],b[0].indexOf("_cats")>0?(d=b[0].split("_")[0],e=b[1].split("."),e.splice(0,1),e.splice(e.length-1,1),this.selectedFacets[d]=e):b[0].indexOf("_op")>0&&(this.selectedOperators[b[0].split("_")[0]]=b[1]))},reloadFacetAndCategories:function(){var b,c,d=[],e={},f=this;a(this.settings.itemSelector).each(function(){a.each(this.attributes,function(){0===this.name.indexOf("fiso-")&&(b=this.name.split("-")[1],d.push(b),e[b]||(e[b]=[]),e[b]=e[b].concat(f.utils.getCategoriesFromAttribute(this.value)))})}),this.facets=this.utils.unique(d),this.facets.sort(),this.facets.reverse();for(c in e)e[c]=this.utils.unique(e[c]),e[c].sort(),e[c].reverse();this.categories=e},filterItems:function(){var a,b,c;this.parseHash(),a=this.hashDict.sort,b=this.hashDict.sort_order,b=b?b:this.default_sort_order,c=this.hashDict.query?this.hashDict.query:"",this.filterSelector=this.utils.getJqueryFilter(this.selectedFacets,this.selectedOperators,c,this.settings),this.$element.isotope({filter:this.filterSelector,sortBy:a?a:this.settings.default_sort_name,sortAscending:"desc"!==b},this.callback)},updateInfo:function(){var a,b,c;this.utils.updateSearch(this.hashDict.query),this.utils.updateTotals(this);for(a in this.facets)b=this.facets[a],c=this.utils.getOperator(b,this.hashDict[b+"_op"],this.settings),this.utils.getOperator(b,c,this.settings),this.utils.updateFacet(b,c,this)}},a.fn[e]=function(b,c){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b,c))}),this}}(jQuery,window,document);